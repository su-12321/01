<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>è·¨å¹´çƒŸèŠ± Â· éŸ³æ•ˆç‰©ç†å€’è®¡æ—¶</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        html, body {
            width: 100%;
            height: 100%;
            background: #0a0f1e;
            overflow: hidden;
            font-family: 'Segoe UI', 'PingFang SC', 'Microsoft YaHei', sans-serif;
        }
        canvas {
            display: block;
            position: absolute;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            cursor: crosshair;
            z-index: 10;
            pointer-events: auto;
        }
        /* å€’è®¡æ—¶é¢æ¿ */
        .countdown-panel {
            position: absolute;
            top: 25px;
            left: 0;
            width: 100%;
            text-align: center;
            color: rgba(255, 255, 255, 0.9);
            text-shadow: 0 0 20px rgba(255, 215, 0, 0.8);
            z-index: 30;
            pointer-events: none;
            font-weight: 600;
            letter-spacing: 2px;
        }
        .greeting {
            font-size: clamp(1.8rem, 8vw, 4rem);
            margin-bottom: 8px;
            background: linear-gradient(45deg, gold, orange, #ff4d4d);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 0 30px rgba(255, 215, 0, 0.5);
            animation: glow 2s ease-in-out infinite;
        }
        .timer {
            font-size: clamp(1.2rem, 5vw, 2.4rem);
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
            display: inline-block;
            padding: 10px 28px;
            border-radius: 60px;
            border: 1px solid rgba(255, 255, 255, 0.25);
            box-shadow: 0 0 30px rgba(255, 0, 0, 0.3);
            color: #fff;
            font-family: 'Courier New', monospace;
            font-weight: 400;
        }
        .hint {
            position: absolute;
            bottom: 20px;
            right: 25px;
            color: rgba(255,255,255,0.4);
            font-size: 14px;
            z-index: 30;
            background: rgba(0,0,0,0.3);
            padding: 6px 14px;
            border-radius: 40px;
            backdrop-filter: blur(2px);
            border: 1px solid rgba(255,215,0,0.2);
            pointer-events: none;
        }
        @keyframes glow {
            0% { filter: drop-shadow(0 0 5px gold); }
            50% { filter: drop-shadow(0 0 25px #ff4d4d); }
            100% { filter: drop-shadow(0 0 5px gold); }
        }
    </style>
</head>
<body>
    <canvas id="fireworksCanvas"></canvas>
    <div class="hint">âœ¨ ç‚¹å‡» / æ‹–åŠ¨ â€” çƒŸèŠ±ä»åœ°é¢å°„å‘å…‰æ ‡ | å€’è®¡æ—¶ç»“æŸè‡ªåŠ¨ç‹‚æ¬¢ âœ¨</div>

    <!-- ä½¿ç”¨jQueryç®€åŒ–æ“ä½œ (ä¹Ÿå¯æ›¿æ¢ä¸ºåŸç”Ÿ, ä½†ä¿ç•™ä¹ æƒ¯) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>

    <script>
        (function() {
            "use strict";

            // ------------------- è·¨å¹´å€’è®¡æ—¶ & æ–°å¹´æ¨¡å¼ ------------------
            const TARGET_YEAR = 2026;       // ç›®æ ‡æ–°å¹´ (å¯ä¿®æ”¹)
            const TARGET_MONTH = 0;          // 0 = ä¸€æœˆ
            const TARGET_DAY = 1;
            const TARGET_HOUR = 0;
            const TARGET_MINUTE = 0;
            const TARGET_SECOND = 0;

            let countdownInterval;
            let newYearModeActive = false;   // æ–°å¹´æ¨¡å¼æ¿€æ´»åè‡ªåŠ¨æ”¾çƒŸèŠ±
            let newYearModeTimer = null;

            function getNextNewYearTime() {
                let now = new Date();
                let year = now.getFullYear();
                let target = new Date(year, TARGET_MONTH, TARGET_DAY, TARGET_HOUR, TARGET_MINUTE, TARGET_SECOND);
                if (now > target) {
                    // è¿‡äº†ä»Šå¹´å…ƒæ—¦ï¼Œå–æ˜å¹´
                    target = new Date(year + 1, TARGET_MONTH, TARGET_DAY, TARGET_HOUR, TARGET_MINUTE, TARGET_SECOND);
                }
                return target.getTime();
            }

            function updateCountdownDisplay() {
                const targetTime = getNextNewYearTime();
                const now = Date.now();
                const diff = targetTime - now;

                if (diff <= 0 && !newYearModeActive) {
                    // åˆ°è¾¾æ–°å¹´ï¼æ¿€æ´»ç‹‚æ¬¢æ¨¡å¼
                    document.getElementById('newYearGreeting').innerText = 'ğŸ‰ æ–° å¹´ å¿« ä¹ ï¼ ğŸ‰';
                    document.getElementById('countdownTimer').innerText = '00:00:00';
                    newYearModeActive = true;

                    // å¼€å¯æ–°å¹´ç‹‚æ¬¢ï¼šæŒç»­è‡ªåŠ¨ç”Ÿæˆå¤§é‡çƒŸèŠ±
                    if (window.fworks) {
                        window.fworks.enableNewYearRave(true);
                    }

                    // æ¸…é™¤å€’è®¡æ—¶æ›´æ–°
                    if (countdownInterval) {
                        clearInterval(countdownInterval);
                        countdownInterval = null;
                    }
                    return;
                }

                if (diff > 0) {
                    const totalSeconds = Math.floor(diff / 1000);
                    const hours = Math.floor(totalSeconds / 3600);
                    const minutes = Math.floor((totalSeconds % 3600) / 60);
                    const seconds = totalSeconds % 60;

                    const timerStr = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                    document.getElementById('countdownTimer').innerText = timerStr;

                    // å¦‚æœæ–°å¹´æ¨¡å¼ä¹‹å‰æ¿€æ´»è¿‡ä½†å€’è®¡æ—¶åˆå¤§äº0 (æå°‘æƒ…å†µ), ä½†ä»¥é˜²ä¸‡ä¸€
                    if (newYearModeActive && diff > 0) {
                        newYearModeActive = false;
                        if (window.fworks) window.fworks.enableNewYearRave(false);
                    }
                }
            }

            // å¯åŠ¨å€’è®¡æ—¶åˆ·æ–°
            updateCountdownDisplay();
            countdownInterval = setInterval(updateCountdownDisplay, 500);

            // ------------------- çƒŸèŠ±å¢å¼ºç±» ---------------------------
            var FireworksEnhanced = function(canvasElem) {
                var self = this;

                // å·¥å…·å‡½æ•°
                var rand = function(rMi, rMa) {
                    return ~~(Math.random() * (rMa - rMi + 1) + rMi);
                };

                var hitTest = function(x1, y1, w1, h1, x2, y2, w2, h2) {
                    return !(x1 + w1 < x2 || x2 + w2 < x1 || y1 + h1 < y2 || y2 + h2 < y1);
                };

                window.requestAnimFrame = (function() {
                    return window.requestAnimationFrame ||
                        window.webkitRequestAnimationFrame ||
                        window.mozRequestAnimationFrame ||
                        window.oRequestAnimationFrame ||
                        window.msRequestAnimationFrame ||
                        function(callback) { window.setTimeout(callback, 1000 / 60); };
                })();

                // ------ éŸ³é¢‘å¼•æ“ (ä½¿ç”¨Web Audioåˆæˆçˆ†ç‚¸å£°) ------
                let audioCtx = null;
                let isAudioReady = false;

                function initAudio() {
                    if (audioCtx) return;
                    try {
                        audioCtx = new (window.AudioContext || window.webkitAudioContext)();
                        isAudioReady = true;
                    } catch (e) {
                        console.warn("Web Audio not supported");
                    }
                }

                // æ’­æ”¾çƒŸèŠ±çˆ†ç‚¸å£° (åˆæˆçŸ­å™ªå£°)
                function playExplodeSound() {
                    if (!audioCtx || !isAudioReady) return;
                    // æ³¨æ„: éŸ³é¢‘ä¸Šä¸‹æ–‡å¯èƒ½è¢«æŒ‚èµ·ï¼Œéœ€åœ¨ç”¨æˆ·æ‰‹åŠ¿åæ¢å¤ã€‚æˆ‘ä»¬åœ¨ç¬¬ä¸€æ¬¡ç‚¹å‡»æ—¶æ¢å¤ã€‚
                    if (audioCtx.state === 'suspended') {
                        audioCtx.resume().then(() => {
                            doPlay();
                        }).catch(() => {});
                    } else if (audioCtx.state === 'running') {
                        doPlay();
                    }

                    function doPlay() {
                        const now = audioCtx.currentTime;
                        const gainNode = audioCtx.createGain();
                        gainNode.connect(audioCtx.destination);

                        // å™ªå£°å‘ç”Ÿå™¨
                        const bufferSize = 4096;
                        const noiseNode = audioCtx.createScriptProcessor(bufferSize, 1, 1);
                        noiseNode.onaudioprocess = function(e) {
                            const output = e.outputBuffer.getChannelData(0);
                            for (let i = 0; i < bufferSize; i++) {
                                output[i] = Math.random() * 2 - 1; // ç™½å™ªå£°
                            }
                        };
                        noiseNode.connect(gainNode);

                        // åŒ…ç»œ: å¿«é€Ÿè¡°å‡
                        gainNode.gain.setValueAtTime(0.25, now);
                        gainNode.gain.exponentialRampToValueAtTime(0.001, now + 0.25);

                        // æ–­å¼€è¿æ¥
                        noiseNode.stop = function() {
                            noiseNode.disconnect();
                            gainNode.disconnect();
                        };
                        setTimeout(() => { noiseNode.stop(); }, 300);
                    }
                }

                // ----- å¢å¼ºç‰©ç†å‚æ•° ----
                self.init = function() {
                    self.canvas = canvasElem;
                    self.ctx = self.canvas.getContext('2d');
                    self.resizeCanvas();

                    self.particles = [];
                    self.fireworks = [];
                    self.mx = self.cw / 2;
                    self.my = self.ch / 2;

                    // èŠ‚æ—¥æ°›å›´è‰²è°ƒ: åˆå§‹ä¸ºé‡‘è‰²åçº¢
                    self.currentHue = rand(20, 50);  // çº¢æ©™é‡‘

                    // å‚æ•°è°ƒä¼˜ (æ›´ç»šçƒ‚)
                    self.partCount = 200;                     // ç²’å­æ•°
                    self.partSpeed = 7;
                    self.partSpeedVariance = 14;
                    self.partWind = 30;                        // é£
                    self.partFriction = 3;                      // æ‘©æ“¦ 3% (æ›´å°‘æ‘©æ“¦, é£˜æ›´ä¹…)
                    self.partGravity = 0.8;                      // é‡åŠ›ç¨å°, é£˜é£˜æ„Ÿ
                    self.hueMin = 0;
                    self.hueMax = 360;
                    self.fworkSpeed = 5;
                    self.fworkAccel = 9;
                    self.hueVariance = 45;                       // é¢œè‰²ä¸°å¯Œ
                    self.flickerDensity = 35;                     // é—ªçƒå¯†åº¦
                    self.showShockwave = true;
                    self.showTarget = false;
                    self.clearAlpha = 18;                         // æ‹–å°¾æ›´é•¿

                    self.lineWidth = 1.8;

                    // æ–°å¹´ç‹‚æ¬¢æ ‡å¿— (è‡ªåŠ¨å‘å°„)
                    self.newYearRave = false;
                    self.raveInterval = null;

                    // ç»‘å®šäº‹ä»¶å’Œå¯åŠ¨å¾ªç¯
                    self.bindEvents();
                    self.canvasLoop();

                    self.canvas.onselectstart = function() { return false; };
                };

                self.resizeCanvas = function() {
                    self.cw = window.innerWidth;
                    self.ch = window.innerHeight;
                    self.canvas.width = self.cw;
                    self.canvas.height = self.ch;
                    self.ctx.lineCap = 'round';
                    self.ctx.lineJoin = 'round';
                    self.ctx.lineWidth = self.lineWidth;
                };

                // åˆ›å»ºç²’å­ (å¢å¼º: äº®åº¦ã€å¤§å°)
                self.createParticles = function(x, y, hue) {
                    // æ’­æ”¾çˆ†ç‚¸éŸ³æ•ˆ (æ¯æ¬¡ç²’å­çˆ†ç‚¸)
                    playExplodeSound();

                    var count = self.partCount;
                    while (count--) {
                        var speed = rand(
                            Math.max(1, self.partSpeed - self.partSpeedVariance),
                            self.partSpeed + self.partSpeedVariance
                        );
                        var newParticle = {
                            x: x,
                            y: y,
                            coordLast: [
                                { x: x, y: y },
                                { x: x, y: y },
                                { x: x, y: y }
                            ],
                            angle: rand(0, 360),
                            speed: speed,
                            friction: 1 - self.partFriction / 100,
                            gravity: self.partGravity / 2 + (Math.random() * 0.2 - 0.1), // éšæœºå¾®å°å˜åŒ–
                            hue: rand(hue - self.hueVariance, hue + self.hueVariance),
                            brightness: rand(70, 100),
                            alpha: rand(60, 100) / 100,
                            decay: rand(5, 25) / 1000,        // è¡°å‡å‡æ…¢
                            wind: (rand(0, self.partWind) - self.partWind / 2) / 25,
                            lineWidth: self.lineWidth * rand(8, 15) / 10,
                            radius: rand(1, 3)                // ç”¨äºé—ªçƒ
                        };
                        self.particles.push(newParticle);
                    }
                };

                self.updateParticles = function() {
                    var i = self.particles.length;
                    while (i--) {
                        var p = self.particles[i];
                        var radians = (p.angle * Math.PI) / 180;
                        var vx = Math.cos(radians) * p.speed;
                        var vy = Math.sin(radians) * p.speed;
                        p.speed *= p.friction;

                        // è½¨è¿¹å†å²
                        p.coordLast[2].x = p.coordLast[1].x;
                        p.coordLast[2].y = p.coordLast[1].y;
                        p.coordLast[1].x = p.coordLast[0].x;
                        p.coordLast[1].y = p.coordLast[0].y;
                        p.coordLast[0].x = p.x;
                        p.coordLast[0].y = p.y;

                        p.x += vx;
                        p.y += vy;
                        p.y += p.gravity;
                        p.angle += p.wind;
                        p.alpha -= p.decay;

                        // è¾¹ç•Œåå¼¹æ•ˆæœ (å¢å¼ºç‰©ç†) â€”â€” è®©ç²’å­ç¢°å£åå¼¹è€Œä¸æ˜¯æ¶ˆå¤±ï¼Œå¢åŠ è¶£å‘³
                        if (p.x < 0 || p.x > self.cw) {
                            // åè½¬è§’åº¦æ°´å¹³æ–¹å‘
                            p.angle = 180 - p.angle;
                            if (p.x < 0) p.x = 2;
                            if (p.x > self.cw) p.x = self.cw - 2;
                            // åå¼¹æŸè€—
                            p.speed *= 0.6;
                        }
                        if (p.y < 0 || p.y > self.ch) {
                            p.angle = -p.angle;
                            if (p.y < 0) p.y = 2;
                            if (p.y > self.ch) p.y = self.ch - 2;
                            p.speed *= 0.6;
                        }

                        // ç§»é™¤æ¡ä»¶æ”¹ä¸º alpha å¤ªä½
                        if (p.alpha < 0.01) {
                            self.particles.splice(i, 1);
                        }
                    }
                };

                self.drawParticles = function() {
                    var i = self.particles.length;
                    while (i--) {
                        var p = self.particles[i];
                        var coordRand = rand(0, 2);
                        self.ctx.beginPath();
                        self.ctx.moveTo(
                            Math.round(p.coordLast[coordRand].x),
                            Math.round(p.coordLast[coordRand].y)
                        );
                        self.ctx.lineTo(Math.round(p.x), Math.round(p.y));
                        self.ctx.closePath();
                        self.ctx.strokeStyle = `hsla(${p.hue}, 100%, ${p.brightness}%, ${p.alpha})`;
                        self.ctx.stroke();

                        if (self.flickerDensity > 0) {
                            var inverseDensity = 60 - self.flickerDensity;
                            if (rand(0, inverseDensity) === 0) {
                                self.ctx.beginPath();
                                self.ctx.arc(Math.round(p.x), Math.round(p.y), rand(1, 3), 0, 2 * Math.PI);
                                self.ctx.closePath();
                                var randAlpha = rand(50, 100) / 100;
                                self.ctx.fillStyle = `hsla(${p.hue}, 100%, ${p.brightness}%, ${randAlpha})`;
                                self.ctx.fill();
                            }
                        }
                    }
                };

                self.createFireworks = function(startX, startY, targetX, targetY) {
                    var angle = Math.atan2(targetY - startY, targetX - startX);
                    var newFirework = {
                        x: startX,
                        y: startY,
                        startX: startX,
                        startY: startY,
                        hitX: false,
                        hitY: false,
                        coordLast: [
                            { x: startX, y: startY },
                            { x: startX, y: startY },
                            { x: startX, y: startY }
                        ],
                        targetX: targetX,
                        targetY: targetY,
                        speed: self.fworkSpeed,
                        angle: angle,
                        shockwaveAngle: angle + 90 * (Math.PI / 180),
                        acceleration: self.fworkAccel / 100,
                        hue: self.currentHue,
                        brightness: rand(70, 100),
                        alpha: rand(70, 100) / 100,
                        lineWidth: self.lineWidth
                    };
                    self.fireworks.push(newFirework);
                };

                self.updateFireworks = function() {
                    var i = self.fireworks.length;
                    while (i--) {
                        var f = self.fireworks[i];
                        // ä¿®å¤ï¼šæ·»åŠ varå£°æ˜
                        var vx = Math.cos(f.angle) * f.speed;
                        var vy = Math.sin(f.angle) * f.speed;
                        f.speed *= 1 + f.acceleration;

                        f.coordLast[2].x = f.coordLast[1].x;
                        f.coordLast[2].y = f.coordLast[1].y;
                        f.coordLast[1].x = f.coordLast[0].x;
                        f.coordLast[1].y = f.coordLast[0].y;
                        f.coordLast[0].x = f.x;
                        f.coordLast[0].y = f.y;

                        // xè½´åˆ¤æ–­
                        if (f.startX >= f.targetX) {
                            if (f.x + vx <= f.targetX) { f.x = f.targetX; f.hitX = true; }
                            else { f.x += vx; }
                        } else {
                            if (f.x + vx >= f.targetX) { f.x = f.targetX; f.hitX = true; }
                            else { f.x += vx; }
                        }

                        if (f.startY >= f.targetY) {
                            if (f.y + vy <= f.targetY) { f.y = f.targetY; f.hitY = true; }
                            else { f.y += vy; }
                        } else {
                            if (f.y + vy >= f.targetY) { f.y = f.targetY; f.hitY = true; }
                            else { f.y += vy; }
                        }

                        if (f.hitX && f.hitY) {
                            self.createParticles(f.targetX, f.targetY, f.hue);
                            self.fireworks.splice(i, 1);
                        }
                    }
                };

                self.drawFireworks = function() {
                    var i = self.fireworks.length;
                    self.ctx.globalCompositeOperation = 'lighter';
                    while (i--) {
                        var f = self.fireworks[i];
                        var coordRand = rand(0, 2);
                        self.ctx.beginPath();
                        self.ctx.moveTo(
                            Math.round(f.coordLast[coordRand].x),
                            Math.round(f.coordLast[coordRand].y)
                        );
                        self.ctx.lineTo(Math.round(f.x), Math.round(f.y));
                        self.ctx.closePath();
                        self.ctx.strokeStyle = `hsla(${f.hue}, 100%, ${f.brightness}%, ${f.alpha})`;
                        self.ctx.stroke();

                        if (self.showShockwave) {
                            self.ctx.save();
                            self.ctx.translate(Math.round(f.x), Math.round(f.y));
                            self.ctx.rotate(f.shockwaveAngle);
                            self.ctx.beginPath();
                            self.ctx.arc(0, 0, 1 * (f.speed / 4), 0, Math.PI, true);
                            self.ctx.strokeStyle = `hsla(${f.hue}, 100%, ${f.brightness}%, ${rand(20, 50) / 100})`;
                            self.ctx.lineWidth = f.lineWidth;
                            self.ctx.stroke();
                            self.ctx.restore();
                        }
                    }
                    self.ctx.globalCompositeOperation = 'source-over';
                };

                // å¼€å¯æ–°å¹´ç‹‚æ¬¢æ¨¡å¼ (è‡ªåŠ¨è¿ç»­çƒŸèŠ±)
                self.enableNewYearRave = function(enable) {
                    self.newYearRave = enable;
                    if (enable) {
                        // æ¯0.2ç§’ä»åº•éƒ¨éšæœºä½ç½®å°„å‘éšæœºç›®æ ‡
                        if (self.raveInterval) clearInterval(self.raveInterval);
                        self.raveInterval = setInterval(function() {
                            if (!self.newYearRave) return;
                            for (let i = 0; i < 3; i++) {  // æ¯æ¬¡3å‘
                                let startX = self.cw / 2 + (Math.random() - 0.5) * 200;
                                let targetX = Math.random() * self.cw;
                                let targetY = Math.random() * self.ch * 0.7;  // ä¸ŠåŠéƒ¨åˆ†
                                self.currentHue = rand(0, 360); // äº”å½©æ–‘æ–“
                                self.createFireworks(startX, self.ch, targetX, targetY);
                            }
                        }, 200);
                    } else {
                        if (self.raveInterval) {
                            clearInterval(self.raveInterval);
                            self.raveInterval = null;
                        }
                    }
                };

                self.bindEvents = function() {
                    $(window).on('resize', function() {
                        clearTimeout(self.resizeTimeout);
                        self.resizeTimeout = setTimeout(function() { self.resizeCanvas(); }, 100);
                    });

                    // ç‚¹å‡»/è§¦æ‘¸å¤„ç†
                    function handleStart(e) {
                        e.preventDefault();
                        // åˆå§‹åŒ–éŸ³é¢‘ (ç”¨æˆ·æ‰‹åŠ¿å)
                        initAudio();
                        if (audioCtx && audioCtx.state === 'suspended') {
                            audioCtx.resume();
                        }

                        var clientX, clientY;
                        if (e.type === 'mousedown') {
                            clientX = e.clientX;
                            clientY = e.clientY;
                        } else {
                            if (e.touches.length > 0) {
                                clientX = e.touches[0].clientX;
                                clientY = e.touches[0].clientY;
                            } else return;
                        }

                        self.mx = clientX;
                        self.my = clientY;
                        self.currentHue = rand(self.hueMin, self.hueMax);
                        self.createFireworks(self.cw / 2, self.ch, self.mx, self.my);

                        function handleMove(e) {
                            e.preventDefault();
                            var moveX, moveY;
                            if (e.type === 'mousemove') {
                                moveX = e.clientX;
                                moveY = e.clientY;
                            } else {
                                if (e.touches.length > 0) {
                                    moveX = e.touches[0].clientX;
                                    moveY = e.touches[0].clientY;
                                } else return;
                            }
                            self.mx = moveX;
                            self.my = moveY;
                            self.currentHue = rand(self.hueMin, self.hueMax);
                            self.createFireworks(self.cw / 2, self.ch, self.mx, self.my);
                        }

                        function handleEnd(e) {
                            e.preventDefault();
                            $(self.canvas).off('mousemove touchmove', handleMove);
                            $(self.canvas).off('mouseup touchend touchcancel', handleEnd);
                        }

                        $(self.canvas).on('mousemove touchmove', handleMove);
                        $(self.canvas).on('mouseup touchend touchcancel', handleEnd);
                    }

                    $(self.canvas).on('mousedown touchstart', handleStart);
                    self.canvas.addEventListener('touchstart', function(e) { e.preventDefault(); }, { passive: false });
                    self.canvas.addEventListener('touchmove', function(e) { e.preventDefault(); }, { passive: false });
                };

                self.canvasLoop = function() {
                    requestAnimFrame(self.canvasLoop, self.canvas);

                    // æ‹–å°¾
                    self.ctx.globalCompositeOperation = 'source-over';
                    self.ctx.fillStyle = 'rgba(0, 0, 0, ' + self.clearAlpha / 100 + ')';
                    self.ctx.fillRect(0, 0, self.cw, self.ch);

                    self.updateFireworks();
                    self.updateParticles();
                    self.drawFireworks();
                    self.drawParticles();
                };

                self.init();
            };

            // å¯åŠ¨å¢å¼ºçƒŸèŠ±
            var canvas = document.getElementById('fireworksCanvas');
            var fworks = new FireworksEnhanced(canvas);
            window.fworks = fworks;  // ä¾¿äºä»æ§åˆ¶å°æˆ–å€’è®¡æ—¶è°ƒç”¨

            // å¦‚æœå·²ç»åˆ°è¾¾æ–°å¹´ï¼ˆé¡µé¢åŠ è½½æ—¶æ°å¥½è¿‡äº†é›¶ç‚¹ï¼‰ï¼Œç«‹å³æ¿€æ´»
            if (new Date() >= new Date(getNextNewYearTime())) {
                newYearModeActive = true;
                fworks.enableNewYearRave(true);
                document.getElementById('newYearGreeting').innerText = 'ğŸ‰ æ–° å¹´ å¿« ä¹ ï¼ ğŸ‰';
                document.getElementById('countdownTimer').innerText = '00:00:00';
                if (countdownInterval) clearInterval(countdownInterval);
            }
        })();
    </script>
</body>
</html>

